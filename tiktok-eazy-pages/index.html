<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TikTok Eazy — Connect</title>
<style>
  :root{
    --bg:#050506;
    --card:#0f0f10;
    --accent1:#25f4ee;
    --accent2:#ff0050;
    --muted:#9aa0a6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;color:#fff;background:linear-gradient(180deg,#050506,#0a0a0b);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:26px;display:grid;grid-template-columns:1fr 420px;gap:20px;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
  .left h1{margin:0;font-size:30px}
  .left p{color:var(--muted);margin:8px 0 18px}
  .card{background:rgba(255,255,255,0.02);padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .btn {display:inline-flex;gap:10px;align-items:center;padding:12px 18px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#000;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#000;margin-right:12px}
  .brand{display:flex;align-items:center}
  .fields{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .field{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.01);font-size:14px}
  code{background:rgba(255,255,255,0.02);padding:6px;border-radius:6px;color:#9df}
  @media(max-width:900px){.wrap{grid-template-columns:1fr;}}
</style>
</head>
<body>
  <div class="wrap" role="main">
    <div class="left">
      <div class="brand">
        <div class="logo">TE</div>
        <div>
          <h1>TikTok Eazy</h1>
          <p class="small">เชื่อมต่อบัญชี TikTok เพื่อจัดการลิงก์สินค้าและอัปโหลดวิดีโอ — พร้อมเดโมสำหรับรีวิว</p>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
          <div>
            <div style="font-weight:700">Connect with TikTok</div>
            <div class="small">กดปุ่มด้านขวาเพื่อเปิดหน้าอนุญาตของ TikTok</div>
          </div>
          <div>
            <button id="loginBtn" class="btn" title="Login with TikTok">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="transform:translateY(-1px)"><path d="M9 12.5c0 2.485 2.015 4.5 4.5 4.5V18c-2.761 0-5-2.239-5-5V6H9v6.5z" fill="#fff"/></svg>
              Login with TikTok
            </button>
          </div>
        </div>

        <div style="margin-top:12px" id="status" class="small">Status: <strong id="statustxt">Not connected</strong></div>

        <div class="fields" aria-hidden="false">
          <div class="field"><div class="small">Client Key (public)</div><div id="clientKey" class="small"></div></div>
          <div class="field"><div class="small">Redirect URI</div><div class="small"><code id="redirDisplay">http://localhost:7890/callback</code></div></div>
          <div class="field"><div class="small">Scopes</div><div id="scopes" class="small"></div></div>
        </div>

        <div style="margin-top:12px" class="small">
          หมายเหตุ: เมื่อล็อกอินเสร็จ TikTok จะ redirect ไปที่ <code>http://localhost:7890/callback</code> (GUI ต้องมี server รับที่พอร์ตนี้) หรือหากบอสเปลี่ยนเป็น redirect กลับเว็บ ให้ลงทะเบียน URL นั้นใน dev console
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <div style="font-weight:700">Quick demo script (พูดสั้น ๆ)</div>
        <div class="small" style="margin-top:8px">"This is TikTok Eazy. I click Login with TikTok, authorize the app, and the site receives the code and shows the account info."</div>
      </div>
    </div>

    <div>
      <div class="card">
        <h3 style="margin:6px 0 8px">Preview / Demo</h3>
        <div style="height:260px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;flex-direction:column;align-items:center;justify-content:center">
          <div style="text-align:center;padding:12px">
            <div style="font-weight:800;font-size:20px">TikTok Eazy</div>
            <div class="small" style="margin-top:6px">Quick connect for reviewers</div>
          </div>
          <div style="margin-top:10px">
            <button id="loginBtn2" class="btn">Login with TikTok</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div style="font-weight:700">How to test</div>
        <ol style="margin:8px 0 0 18px;padding:0 0 0 0" class="small">
          <li>แก้ค่า CLIENT_KEY ในสคริปต์</li>
          <li>ตรวจว่า redirect URL ลงทะเบียนใน TikTok Dev (localhost หรือเว็บ)</li>
          <li>รัน local server (ถ้าจะรับ code ที่ localhost)</li>
          <li>กดปุ่ม → authorize → server จะรับ code แล้วแลก token</li>
        </ol>
      </div>
    </div>
  </div>

<script>
/* CONFIG: เปลี่ยน CLIENT_KEY ให้เป็นของบอส */
const CLIENT_KEY = 'REPLACE_WITH_CLIENT_KEY';
const REDIRECT_URI = 'http://localhost:7890/callback'; // ให้ตรงกับ TikTok Dev
const SCOPES = 'user.info.basic video.upload video.publish';
const AUTHORIZE_BASE = 'https://open-api.tiktok.com/platform/oauth/connect/';
const RESPONSE_TYPE = 'code';

document.getElementById('clientKey').innerText = CLIENT_KEY || '(not set)';
document.getElementById('scopes').innerText = SCOPES;
document.getElementById('redirDisplay').innerText = REDIRECT_URI;

function genState(len=20){
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  return Array.from({length:len}).map(()=>chars[Math.floor(Math.random()*chars.length)]).join('');
}
function buildAuthUrl(){
  const state = genState();
  const p = new URLSearchParams({
    client_key: CLIENT_KEY,
    response_type: RESPONSE_TYPE,
    scope: SCOPES,
    redirect_uri: REDIRECT_URI,
    state: state
  });
  return AUTHORIZE_BASE + '?' + p.toString();
}

function openOAuthPopup(){
  if(!CLIENT_KEY || CLIENT_KEY.includes('REPLACE')){
    alert('กรุณาแก้ CLIENT_KEY ในไฟล์ก่อนทดสอบ');
    return;
  }
  const url = buildAuthUrl();
  // open popup
  const w = 900, h = 720;
  const left = (screen.width/2)-(w/2);
  const top = (screen.height/2)-(h/2);
  const win = window.open(url,'tiktok_oauth',`width=${w},height=${h},left=${left},top=${top}`);
  if(!win){
    window.location.href = url;
    return;
  }
  document.getElementById('statustxt').innerText='Waiting for OAuth...';
  const timer = setInterval(()=>{
    if(win.closed){
      clearInterval(timer);
      document.getElementById('statustxt').innerText='Popup closed — check local GUI for code';
    }
  },800);
}

// small ping to check if local GUI exists (optional)
async function pingLocal(){
  try{
    const r = await fetch('http://localhost:7890/health',{mode:'cors'});
    if(r.ok){
      document.getElementById('statustxt').innerText='Local GUI detected (ready)';
    }
  }catch(e){}
}

document.getElementById('loginBtn').addEventListener('click', openOAuthPopup);
document.getElementById('loginBtn2').addEventListener('click', openOAuthPopup);
pingLocal();
</script>
</body>
</html>

